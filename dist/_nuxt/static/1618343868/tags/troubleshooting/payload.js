__NUXT_JSONP__("/tags/troubleshooting", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H){return {data:[{articles:[{slug:"Troubleshooting-SMTP",description:g,title:"Troubleshooting SMTP",date:"2008-08-13T00:00:00.000Z",categories:["SysAdmin","Email"],tags:["SMTP","email","troubleshooting"],keywords:["tech"],thumbnailImage:"\u002Fimages\u002FInternet-mail-thumb.png",autoThumbnailImage:i,thumbnailImagePosition:"left",metaAlignment:"center",comments:i,toc:[{id:j,depth:k,text:l},{id:m,depth:k,text:n}],body:{type:o,children:[{type:b,tag:e,props:{},children:[{type:a,value:g}]},{type:a,value:c},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:b,tag:"em",props:{},children:[{type:a,value:"Note: This article was written almost 10 years ago.  While it's still mostly true, it doesn't talk about encryption at all, which is fairly commonplace in the world of SMTP today.  Back then SPF and DKIM weren't around either.   For basic troubleshooting, it's still valid."}]}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"Here's how it works, when you write your email, it gets submitted into the mail system and, if the destination is off server, ends up with your sending servers SMTP subsystem."}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"I'm not going to talk about how to configure your email, there are lots of really terrific guides on the Internet on how to do that (just google \"set up \u003Cname of email software on "},{type:b,tag:"name",props:{of:h,operating:h,system:h},children:[{type:a,value:"\").  I'm going to talk about how to figure out what is wrong when it doesn't work after you've completed all theose steps."}]}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"Here's what normally happens:"}]},{type:a,value:c},{type:b,tag:p,props:{},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"The SMTP server program tries to figure out where to send your email. This is done by doing a DNS lookup for an MX record on the domain part of the address. (If there is no MX record, it will do a normal query for the domain part, if that doesn't work, you get a bounce message saying that the message couldn't be delivered.  If your system is really borked, that message will be sitting in the outgoing mail queue too!)."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"The server attempts to open a connection on TCP port 25 to the remote IP determined in step 1 above."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"If successful, it does it's handshaking to determine encryption, authentication, etc."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"It sends the message.   Once it gets the OK from the remote side, it deletes the message."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"While cofiguring a new mail server (or moving it to a new IP) there are lots of things that need to work just to make basic mail flow, particularly from the world in."}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"I've always found it useful to perform these steps manually in order to identify where things might not be working."}]},{type:a,value:c},{type:b,tag:q,props:{id:j},children:[{type:b,tag:f,props:{href:"#replicating-the-process",ariaHidden:r,tabIndex:s},children:[{type:b,tag:t,props:{className:[u,v]},children:[]}]},{type:a,value:l}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"Start off by doing a dig on the domain name in question.   If you're on MacOS, you're in luck, dig is installed by default.  If you're on windows, download a copy "},{type:b,tag:f,props:{href:"https:\u002F\u002Fwww.danesparza.net\u002F2011\u002F05\u002Fusing-the-dig-dns-tool-on-windows-7\u002F",rel:[w,x,y],target:z},children:[{type:a,value:"here"}]},{type:a,value:A}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"{{\u003C alert info \u003E}}All the input is highlight blue.{{\u003C \u002Falert \u003E}}"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"macadoo:~ mrunkel$ {{\u003C hl-text primary \u003E}}dig untangle.com mx{{\u003C \u002Fhl-text \u003E}}"}]},{type:a,value:c},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,F]},children:[{type:b,tag:G,props:{},children:[{type:a,value:"; \u003C\u003C\u003E\u003E DiG 9.4.2-P2 \u003C\u003C\u003E\u003E untangle.com mx\n;; global options:  printcmd\n;; Got answer:\n;; -\u003E\u003EHEADER\u003C\u003C- opcode: QUERY, status: NOERROR, id: 32638\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; QUESTION SECTION:\n;untangle.com.          IN  MX\n\n;; ANSWER SECTION:\nuntangle.com.       202 IN  MX  10 mail.untangle.com.\n\n;; ADDITIONAL SECTION:\nmail.untangle.com.  170 IN  A   198.144.196.58\n\n;; Query time: 1 msec\n;; SERVER: 10.0.0.1#53(10.0.0.1)\n;; WHEN: Mon Nov  3 11:27:34 2008\n;; MSG SIZE  rcvd: 67\n\nmacadoo:~ mrunkel$\n"}]}]}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"{{\u003C alert info \u003E}}\nYou can specify a DNS server by appending @\u003CDNS Server Name\u002FIP\u003E to the command line.  This can be useful to force a check of the \"public\" DNS system vs. what your internal DNS server says.\n{{\u003C \u002Falert \u003E}}"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"So, what just happend?  Using the dig command line program, we asked the default DNS server for the MX (Mail eXchange) record for the domain unangle.com.  then dig printed a bunch of info."}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"After \"Got Answer\" we have a bunch of status information.  Under QUESTION SECTION, we see the question we asked.  Under ANSWER SECTION is the answer to our query.\nIn the ADDITIONAL SECTION is a further lookup, because the answer we received included a"}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"Once you have the IP address of the server, you can telnet to port 25.. (If you'll notice, I've replaced all the TLD's with .spam in order to keep spam scrapers from getting my email addresses."}]},{type:a,value:c},{type:b,tag:B,props:{className:[C]},children:[{type:b,tag:D,props:{className:[E,F]},children:[{type:b,tag:G,props:{},children:[{type:a,value:"macadoo:~ mrunkel$ {{\u003C hl-text primary \u003E}}telnet mail.untangle.com 25{{\u003C \u002Fhl-text \u003E}}\nTrying 198.144.196.58...\nConnected to mail.untangle.spam.\nEscape character is '^]'.\n220 mail.untangle.spam ESMTP Exim 4.63 Mon, 03 Nov 2008 11:32:19 -0800\n{{\u003C hl-text primary \u003E}}HELO host51.untangle.spam{{\u003C \u002Fhl-text \u003E}}\n250 mail.untangle.spam Hello host51.untangle.spam [198.144.196.51]\n{{\u003C hl-text primary \u003E}}MAIL FROM: marc@runkel.spam{{\u003C \u002Fhl-text \u003E}}\n250 OK\n{{\u003C hl-text primary \u003E}}RCPT TO: mrunkel@untangle.spam{{\u003C \u002Fhl-text \u003E}}\n250 Accepted\n{{\u003C hl-text primary \u003E}}DATA{{\u003C \u002Fhl-text \u003E}}\n354 Start mail input; end with \u003CCRLF\u003E.\u003CCRLF\u003E\n{{\u003C hl-text primary \u003E}}From: marc@runkel.spam\nTo: marc@runkel.spam\nDate: yesterday\nSubject: Test email\n\nThis is a test email.  Have fun reading it later.\n\nm.\n\n.\n{{\u003C \u002Fhl-text \u003E}}\n250 OK id=1Kx5CE-0004Iq-9s\n{{\u003C hl-text primary \u003E}}QUIT{{\u003C \u002Fhl-text \u003E}}\n221 mail.untangle.spam closing connection\nConnection closed by foreign host.\nmacadoo:~ mrunkel$\n"}]}]}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"Here's what we did:"}]},{type:a,value:c},{type:b,tag:p,props:{},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"We connected to the receiving mail server"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"We identified ourselves to the server with the HELO command"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"We told the server where the mail was from"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"We told the server where the mail was going"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"We gave the actual payload (the message) to the server."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"200 messages are \"ok\"\n300 messages are \"ok but i need more info\"\n400 and 500 messages are \"you screwed up\""}]},{type:a,value:c},{type:b,tag:q,props:{id:m},children:[{type:b,tag:f,props:{href:"#notes-and-troubleshooting-tips",ariaHidden:r,tabIndex:s},children:[{type:b,tag:t,props:{className:[u,v]},children:[]}]},{type:a,value:n}]},{type:a,value:c},{type:b,tag:"ul",props:{},children:[{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Some servers don't like backspaces, so if you enter one, you might need to enter the command again."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Terminate the email body with a blank line, a period, and another blank line."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"If you use the hostname instead of the IP to telnet, make sure they resolve to the same thing."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"If you can't connect, then you have a firewall or port forward issue."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"If your server doesn't announce it's publicly resolvable domain name in the first 220 line, you might have some problems with strict senders."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Some servers will disconnect you if your publicly resolvable name doesn't match what you type on the HELO line."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"If you get disconnected after MAIL FROM:, you probably have an RBL problem on your sending IP. Go to SpamHaus and check."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"If you get errors on RCPT TO: then your mail server isn't configured to accept mail for the correct domains."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"If you get relaying denied, your server is either mis-configured for relaying the right IP ranges, or you need to authenticate to the server. You should never set up your server to relay from any public IP space. It's just too risky. If you do have to, make sure it's restricted to IPs that only you have access too."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"In the DATA portion, the first part is the 'soft' headers. You can add headers here for the remote client to interpret and include. They are optional. Email body starts either immediately or after a blank line if you include headers."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Usually, if you can get to the DATA portion, everything is working fine."}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:e,props:{},children:[{type:a,value:"For more information on SMTP check out the "},{type:b,tag:f,props:{href:"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FSimple_Mail_Transfer_Protocol",rel:[w,x,y],target:z},children:[{type:a,value:"wikipedia page"}]},{type:a,value:A}]}]},excerpt:{type:o,children:[{type:b,tag:e,props:{},children:[{type:a,value:g}]}]},dir:"\u002Farticles",path:"\u002Farticles\u002FTroubleshooting-SMTP",extension:".md",createdAt:H,updatedAt:H}]}],fetch:{},mutations:void 0}}("text","element","\n","li","p","a","Internet email is easy to troubleshoot if you do it step by step.   This is a quick guide to troubleshooting what's wrong when you can't send or receive email.","",false,"replicating-the-process",2,"Replicating the process","notes-and-troubleshooting-tips","Notes and troubleshooting tips","root","ol","h2","true",-1,"span","icon","icon-link","nofollow","noopener","noreferrer","_blank",".","div","nuxt-content-highlight","pre","language-text","line-numbers","code","2018-03-22T14:33:41.000Z")));